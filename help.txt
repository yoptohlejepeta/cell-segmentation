# detekce jader

img_unsharp = iw.unsharp_mask_img(img, radius=20, percent=300, threshold=3)
r1, g1, b1 = img_unsharp[:, :, 0], img_unsharp[:, :, 1], img_unsharp[:, :, 2]
b_bin_otsu = cw.convert_grayscale_to_bin_otsu(b1)
b_bin_otsu_morp = iw.close_holes_remove_noise(b_bin_otsu, mask_size=5, iterations=6)
img_labeled_nuclei, nr_nuclei = mh.label(b_bin_otsu_morp)
img_labeled_nuclei = iw.remove_small_regions(img_labeled_nuclei, min_size=100)

# detekce obalu
img_c_corrected = cca.automatic_color_equalization(img, slope=10, limit=1000, samples=500)
img_blurred = gaussian_filter(img_c_corrected, sigma=10)
RGB_balanced = cca.luminance_weighted_gray_world(img_blurred, subwidth=20, subweight=20)
r2, g2, b2 = RGB_balanced[:, :, 0], RGB_balanced[:, :, 1], RGB_balanced[:, :, 2]
thresholds = filters.threshold_multiotsu(g2)
regions = np.digitize(g2, bins=thresholds)
bin_cyto_nuclei = cw.convert_labeled_to_bin(regions, background=2)
bin_cyto_nuclei = iw.close_holes_remove_noise(bin_cyto_nuclei, mask_size=3, iterations=5)
img_labeled_cytoplasm, nr_cytoplasm = mh.label(img_bin_morp)
img_labeled_cytoplasm = iw.remove_small_regions(img_labeled_cytoplasm, min_size=100)
img_cytoplasm_nuclei = mh.labeled.remove_bordering(img_labeled_cytoplasm)
